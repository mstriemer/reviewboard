<!DOCTYPE html>
<html>
    <head>
        <title>OAuth 2.0 Client</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
        <script type="text/javascript">
            $.support.cors = true;

            function getParameterByName( name )
            {
                name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
                var regexS = "[\\?&]"+name+"=([^&#]*)";
                var regex = new RegExp( regexS );
                var results = regex.exec( window.location.href );
                if( results == null )
                    return "";
                else
                    return decodeURIComponent(results[1].replace(/\+/g, " "));
            }

            $(function() {
                $('#code').val(getParameterByName('code'));
                $('#access_token').val(getParameterByName('access_token'));
                $('#refresh_token').val(getParameterByName('refresh_token'));
            });

            function access_token_error(jqXHR, textStatus, errorThrown) {
                alert('Status: ' + textStatus + '. Request unsuccessful. (' + errorThrown + ')');
            }

            function got_access_token(data, textStatus, jqXHR) {
                $('#access_token').val(data.access_token);
                $('#refresh_token').val(data.refresh_token);
            }

            function get_access_token() {
                $.ajax({
                    url: 'http://127.0.0.1:8080/oauth/token/',
                    type: 'POST',
                    data: {
                        'grant_type': 'authorization_code',
                        'redirect_uri': 'http://striemer.ca/oauth-client.html',
                        'client_id': $('#client_id').val(),
                        'client_secret': $('#client_secret').val(),
                        'code': $('#code').val()
                    },
                    success: got_access_token,
                    error: access_token_error
                });
            }
        </script>
    </head>
    <body>
        <p><a href="http://127.0.0.1:8080/oauth/authorize/?response_type=code&amp;client_id=test&amp;redirect_uri=http://striemer.ca/oauth-client.html">Authorize with ReviewBoard</a></p>
        <p>Request access and refresh tokens</p>
        <form action="http://127.0.0.1:8080/oauth/token/" method="post">
            <input type="hidden" name="grant_type" value="authorization_code" />
            <input type="hidden" name="redirect_uri" value="http://striemer.ca/oauth-client.html" />
            <label for="client_id">Client id:</label> <input type="text" id="client_id" name="client_id" value="test" /><br />
            <label for="client_secret">Client secret:</label> <input type="text" id="client_secret" name="client_secret" value="terces" /><br />
            <label for="code">Code:</label> <input type="text" id="code" name="code" value="code" /><br />
            <input type="submit" value="Get access token" />
        </form>
        <br />
        <form action="http://127.0.0.1:8080/oauth/protected/">
            <input type="hidden" name="client_id" id="protected_client_id" value="" />
            <label for="access_token">Access token:</label> <input type="text" id="access_token" name="access_token" value="" /><br />
            <label for="refresh_token">Refresh token:</label> <input type="text" id="refresh_token" name="refresh_token" value="" /><br />
            <input type="submit" value="Get protected resource" onclick="$('#protected_client_id').val($('#client_id').val());" />
        </form>
    </body>
</html>

